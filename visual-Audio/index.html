<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Resizable Visualizer Layout</title>

<!-- CSS -->
<link rel="stylesheet" href="style.css">

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>

<!-- Exposer l'analyser que l'on cr√©era depuis app.js -->
<script>
  // createSharedAnalyser() sera appel√© depuis app.js apr√®s avoir initialis√© `audio`
  window.createSharedAnalyser = async function(audioElement){
    if (!audioElement) return;
    const AudioContextCtor = window.AudioContext || window.webkitAudioContext;
    // si un contexte existe d√©j√† (s√©curit√©), on l'utilise
    if (window.externalAudioContext && window.externalAudioContext.state) {
      // reconnecter la source si n√©cessaire
      const ctx = window.externalAudioContext;
      // si la source existait, ne recr√©e pas
      try {
        const src = ctx.createMediaElementSource(audioElement);
        const analyser = ctx.createAnalyser();
        analyser.fftSize = 512;
        src.connect(analyser);
        src.connect(ctx.destination);
        window.externalAnalyser = analyser;
        window.externalAudioElement = audioElement;
        console.log("shared analyser ready (recreated)");
        return;
      } catch(e){
        // ok fallback on continue to create a new context
        console.warn("couldn't reuse externalAudioContext", e);
      }
    }

    const ctx = new AudioContextCtor();
    const src = ctx.createMediaElementSource(audioElement);
    const analyser = ctx.createAnalyser();
    analyser.fftSize = 512;
    src.connect(analyser);
    src.connect(ctx.destination);

    // rendre accessible au script 3D
    window.externalAudioContext = ctx;
    window.externalAnalyser = analyser;
    window.externalAudioElement = audioElement;
    console.log("shared analyser ready");
  };
</script>

<!-- script du visualizer 3D (modifi√©, ne d√©marre pas tout seul) -->
<script src="3d-audio-visualizer/script.js"></script>

<!-- Split.js -->
<script src="https://unpkg.com/split.js/dist/split.min.js"></script>
</head>
<body>

  

<div id="top">
  <div id="left" class="pane">
      <div class="title">Visualizer 2D</div>
      <canvas id="visualizer2d"></canvas>
  </div>

  

  <div id="right" class="pane">
      <div class="title">Visualizer 3D</div>
      <canvas id="visualizer3d"></canvas>
  </div>
</div>

<div id="bottom">
   <div id="visualizer3-container" class="pane" style="height:150px;">
        <div class="title">Visualizer Waves</div>
        <canvas id="visualizer3"></canvas>
    </div>
    <div class="title">Terminal</div>

    <div id="music-controls">
        <label><input type="radio" name="music" value="rap"> Rap</label>
        <label><input type="radio" name="music" value="techno"> Techno</label>
        <label><input type="radio" name="music" value="electro"> Electro</label>
        <label><input type="radio" name="music" value="techno-acid"> Techno Acid</label>
        <label><input type="radio" name="music" value="pop"> Pop</label>

        <label><input type="radio" name="music" value="groove-metal"> groove-metal</label>
        <label><input type="radio" name="music" value="fonk"> fonk</label>
        <label><input type="radio" name="music" value="slow-fonk"> slow-fonk</label>
        <label><input type="radio" name="music" value="color-wave"> color-wave</label>
        <label><input type="radio" name="music" value="metal-japonais"> metal-japonais</label>
        <label><input type="radio" name="music" value="son-turc"> son-turc</label>

        <br>
        <label for="file-input" style="color:#0bcf6c; cursor:pointer; margin-left:0px;">
          üéµ Charger fichier
        </label>
        <input type="file" id="file-input" accept="audio/*" style="display:none;">

    </div>



    <div id="terminal">> ready...</div>
</div>

<!-- JS -->
<script src="app.js"></script>

</body>
</html>
